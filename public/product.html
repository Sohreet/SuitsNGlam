<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product - Suits N Glam</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <style>
    body { background:#f8f9fa; }
    .main-img { width:100%; height:380px; object-fit:cover; border-radius:12px; }
    .thumb-img { width:70px; height:70px; object-fit:cover; border-radius:8px; cursor:pointer; border:2px solid transparent; }
    .thumb-img.active { border-color:#c60000; }
    .meter-btn { width:32px; }
    .nav-login-area { visibility: visible !important; }
    .btn-login { background:#ff3f33; color:#fff; border-radius:6px; padding:6px 14px; border:none; font-weight:600;}
    .btn-login:hover { background:#ff2b1f; }
    .home-icon { font-size:1.6rem; cursor:pointer; margin-right:12px; }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg" style="background-color:#e3f2fd;">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Suits N Glam</a>

    <div class="ms-auto d-flex align-items-center nav-login-area">
      <i class="bi bi-house-fill home-icon" title="Home" onclick="location.href='index.html'"></i>
      <button id="loginBtn" class="btn-login">Login</button>
      <img id="accountIcon" style="width:34px;height:34px;border-radius:50%;display:none;margin-left:10px;cursor:pointer;">
    </div>
  </div>
</nav>

<!-- Product content -->
<div class="container mt-4">
  <div class="row">
    <div class="col-md-6">
      <img id="mainImage" class="main-img" src="" alt="Product image">
      <div id="thumbRow" class="d-flex gap-2 mt-3"></div>

      <div id="videoSection" style="display:none;" class="mt-3">
        <video id="productVideo" controls class="w-100 rounded"></video>
      </div>
    </div>

    <div class="col-md-6">
      <h2 id="p_name"></h2>
      <h4 class="text-danger fw-bold">â‚¹<span id="p_price">0</span> / metre</h4>
      <p class="text-muted">Category: <span id="p_category"></span></p>
      <h6 class="mt-3 fw-bold">Description:</h6>
      <p id="p_desc"></p>

      <h6 class="mt-3 fw-bold">Stock:</h6>
      <p id="p_stock"></p>

      <div class="d-flex align-items-center gap-2 mt-3">
        <button class="btn btn-outline-secondary meter-btn" onclick="changeMetre(-1)">-</button>
        <input id="metreInput" class="form-control text-center" style="width:60px;" value="1" readonly>
        <button class="btn btn-outline-secondary meter-btn" onclick="changeMetre(1)">+</button>
      </div>

      <button id="addCartBtn" class="btn btn-danger mt-4 w-100" onclick="addToCartPage()">Add to Cart</button>

      <div class="mt-3">
        <a id="proceedToCheckoutBtn" class="btn btn-success w-100" href="checkout.html">Proceed to Checkout</a>
      </div>

    </div>
  </div>
</div>

<script src="js/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* Local product page helpers rely on app.js */
let currentProduct = null;

function changeMetre(delta) {
  const el = document.getElementById("metreInput");
  let v = parseInt(el.value || "1", 10);
  v = Math.max(1, Math.min(6, v + delta));
  el.value = v;
}

/* Called by app.js after product fetch */
async function loadProductPage() {
  // app.js provides loadSingleProduct which sets window.selectedProduct
  await loadSingleProduct(); // from app.js
  const p = window.selectedProduct;
  if (!p) { alert("Product not found"); location.href = "index.html"; return; }

  currentProduct = p;

  document.getElementById("p_name").textContent = p.name;
  document.getElementById("p_price").textContent = p.price;
  document.getElementById("p_category").textContent = p.category;
  document.getElementById("p_desc").textContent = p.description || "";

  const stockEl = document.getElementById("p_stock");
  const addBtn = document.getElementById("addCartBtn");
  if (!p.stock || Number(p.stock) <= 0) {
    stockEl.innerHTML = '<span class="text-danger fw-bold">OUT OF STOCK</span>';
    addBtn.disabled = true;
    addBtn.textContent = "Out of Stock";
  } else {
    stockEl.innerHTML = `<span class="text-success fw-bold">In Stock (${p.stock})</span>`;
    addBtn.disabled = false;
    addBtn.textContent = "Add to Cart";
  }

  // images thumbs
  const mainImg = document.getElementById("mainImage");
  const thumbRow = document.getElementById("thumbRow");
  mainImg.src = p.images?.[0] || "";
  thumbRow.innerHTML = "";
  (p.images || []).forEach((img, i) => {
    const imgEl = document.createElement("img");
    imgEl.src = img;
    imgEl.className = "thumb-img" + (i === 0 ? " active" : "");
    imgEl.onclick = () => {
      mainImg.src = img;
      document.querySelectorAll(".thumb-img").forEach(t=>t.classList.remove("active"));
      imgEl.classList.add("active");
    };
    thumbRow.appendChild(imgEl);
  });

  if (p.video) {
    document.getElementById("videoSection").style.display = "block";
    document.getElementById("productVideo").src = p.video;
  } else {
    document.getElementById("videoSection").style.display = "none";
  }
}

/* add to cart using app.js helper */
function addToCartPage() {
  const metres = Number(document.getElementById("metreInput").value || 1);
  if (!currentProduct) return alert("No product loaded");
  addToCart(currentProduct._id, metres);
}

/* wait for app.js to set window.selectedProduct by calling loadProductPage */
document.addEventListener("DOMContentLoaded", () => {
  // app.js exposes loadSingleProduct which fetches product & sets window.selectedProduct
  (async () => {
    // loadSingleProduct() in app.js sets window.selectedProduct; call it then render
    await loadSingleProduct();
    if (window.selectedProduct) {
      currentProduct = window.selectedProduct;
      // fill fields
      document.getElementById("p_name").textContent = currentProduct.name;
      document.getElementById("p_price").textContent = currentProduct.price;
      document.getElementById("p_category").textContent = currentProduct.category;
      document.getElementById("p_desc").textContent = currentProduct.description || "";
      // set images/video/stock via the page helper
      loadProductPage();
    }
  })();
});
</script>
</body>
</html>
