<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - Suits N Glam</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <style>
    body { background:#f8f9fa; }
    .nav-login-area { visibility: visible !important; }

    .img-preview {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
      margin-right: 5px;
    }

    .video-preview {
      width: 120px;
      border-radius: 10px;
    }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg" style="background-color:#e3f2fd;">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Suits N Glam</a>

    <div class="ms-auto d-flex align-items-center">
      <!-- Admin badge -->
      <span class="badge bg-danger me-3">ADMIN</span>

      <!-- Account icon -->
      <img id="accountIcon" style="width:34px;height:34px;border-radius:50%;cursor:pointer;">
    </div>
  </div>
</nav>


<div class="container mt-4">

  <h2>Admin Dashboard</h2>
  <hr>

  <!-- ADD PRODUCT CARD -->
  <div class="card p-4 shadow-sm">

    <h4>Add Product</h4>
    <hr>

    <div class="row g-3">

      <div class="col-md-4">
        <label class="form-label">Product Name</label>
        <input id="p_name" class="form-control" placeholder="Name">
      </div>

      <div class="col-md-4">
        <label class="form-label">Price Per Metre (₹)</label>
        <input id="p_price" type="number" class="form-control" placeholder="Price">
      </div>

      <div class="col-md-4">
        <label class="form-label">Stock</label>
        <input id="p_stock" type="number" class="form-control" placeholder="Stock quantity">
      </div>

      <div class="col-md-4">
        <label class="form-label">Category</label>
        <select id="p_category" class="form-select">
          <option value="summer">Summer</option>
          <option value="winter">Winter</option>
          <option value="wedding">Wedding</option>
          <option value="casuals">Casuals</option>
          <option value="dailywear">Daily Wear</option>
          <option value="premiumwear">Premium Wear</option>
          <option value="sales">Sales</option>
          <option value="bestdeals">Best Deals</option>
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Description</label>
        <textarea id="p_desc" class="form-control" rows="3" placeholder="Short product details"></textarea>
      </div>

      <!-- IMAGE UPLOAD -->
      <div class="col-12">
        <label class="form-label">Upload Images (2–5)</label>
        <input id="p_images" type="file" class="form-control" accept="image/*" multiple>
        <small class="text-muted">Select 2–5 images</small>

        <div id="imgPreview" class="d-flex mt-2"></div>
      </div>

      <!-- VIDEO UPLOAD -->
      <div class="col-12">
        <label class="form-label">Upload Video (optional)</label>
        <input id="p_video" type="file" class="form-control" accept="video/*">

        <div id="vidPreview" class="mt-2"></div>
      </div>

      <!-- SALE TOGGLE -->
      <div class="col-12">
        <label class="form-check">
          <input class="form-check-input" type="checkbox" id="p_sale">
          <span class="form-check-label fw-bold">Put this product on SALE</span>
        </label>
      </div>

    </div>

    <button class="btn btn-success mt-4" onclick="adminAddProduct()">Add Product</button>
    <button class="btn btn-secondary mt-4 ms-2" onclick="window.location.href='admin-orders.html'">View Orders</button>
    <button class="btn btn-danger mt-4 ms-2" onclick="adminLogout()">Logout</button>

  </div>

  <!-- PRODUCT LIST PREVIEW -->
  <div class="mt-4">
    <h4>All Products</h4>
    <div id="productsAdminList"></div>
  </div>

</div>


<script>
/******************************************************
 * ADMIN LOGOUT
 ******************************************************/
function adminLogout() {
  localStorage.removeItem("adminLoggedIn");
  localStorage.removeItem("sg_user");
  window.location.href = "index.html";
}

/******************************************************
 * BASE64 CONVERSION
 ******************************************************/
function fileToBase64(file) {
  return new Promise(resolve => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.readAsDataURL(file);
  });
}

/******************************************************
 * IMAGE PREVIEW
 ******************************************************/
document.getElementById("p_images").addEventListener("change", function() {
  const preview = document.getElementById("imgPreview");
  preview.innerHTML = "";

  [...this.files].forEach(file => {
    const reader = new FileReader();
    reader.onload = e => {
      preview.innerHTML += `<img src="${e.target.result}" class="img-preview">`;
    };
    reader.readAsDataURL(file);
  });
});

/******************************************************
 * VIDEO PREVIEW
 ******************************************************/
document.getElementById("p_video").addEventListener("change", function() {
  const preview = document.getElementById("vidPreview");
  preview.innerHTML = "";

  if (this.files.length > 0) {
    const reader = new FileReader();
    reader.onload = e => {
      preview.innerHTML = `
        <video class="video-preview" controls>
          <source src="${e.target.result}">
        </video>`;
    };
    reader.readAsDataURL(this.files[0]);
  }
});

/******************************************************
 * ADD PRODUCT
 ******************************************************/
async function adminAddProduct() {

  const name = p_name.value.trim();
  const price = Number(p_price.value);
  const stock = Number(p_stock.value);
  const category = p_category.value.trim().toLowerCase();
  const desc = p_desc.value.trim();
  const sale = p_sale.checked;

  if (!name || !price || !category) {
    return alert("Please fill all required fields!");
  }

  // Convert IMAGES to base64
  let images = [];
  for (let file of p_images.files) {
    images.push(await fileToBase64(file));
  }

  // Convert VIDEO to base64 (optional)
  let video = "";
  if (p_video.files.length > 0) {
    video = await fileToBase64(p_video.files[0]);
  }

  const body = { name, price, category, description: desc, stock, images, video, sale };

  const res = await fetch("/api/admin/products", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(body),
  });

  const data = await res.json();

  if (data.success) {
    alert("Product added successfully!");
    renderAdminProducts();
  } else {
    alert("Error adding product");
  }
}

/******************************************************
 * RENDER ALL PRODUCTS (PREVIEW ONLY)
 ******************************************************/
async function renderAdminProducts() {
  const out = document.getElementById("productsAdminList");
  const res = await fetch("/api/products/category/all");
  const products = await res.json();

  out.innerHTML = products.map(p => `
    <div class="card p-2 mb-2">
      <div class="d-flex align-items-center">

        <img src="${p.images?.[0]}" class="img-preview">

        <div class="ms-2">
          <strong>${p.name}</strong>  
          <br>
          ₹${p.price} — ${p.category}
          ${p.sale ? `<span class="badge bg-primary ms-2">SALE</span>` : ""}
          ${p.stock === 0 ? `<span class="badge bg-danger ms-2">OUT OF STOCK</span>` : ""}
        </div>

      </div>
    </div>
  `).join("");
}

document.addEventListener("DOMContentLoaded", () => {
  if (!localStorage.getItem("adminLoggedIn")) {
    window.location.href = "index.html";
  }

  renderAdminProducts();
});
</script>

<script src="js/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
