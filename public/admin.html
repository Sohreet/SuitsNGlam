<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard - Suits N Glam</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <style>
    body { background:#f8f9fa; }
    .nav-login-area { visibility:visible !important; }

    .thumb-preview {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 6px;
      margin-right: 8px;
    }

    .admin-badge {
      background:#c60000;
      color:white;
      padding:4px 10px;
      border-radius:6px;
      font-weight:700;
      margin-left:8px;
    }

  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg" style="background-color:#e3f2fd;">
  <div class="container">

    <a class="navbar-brand fw-bold" href="index.html">Suits N Glam</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">

      <ul class="navbar-nav ms-auto me-2">
        <li class="nav-item"><a class="nav-link" href="allproducts.html">All Products</a></li>
      </ul>

      <div class="nav-login-area d-flex align-items-center">
        <img id="accountIcon" style="width:34px;height:34px;border-radius:50%;display:none;cursor:pointer;">
        <span id="adminBadgeNav" class="admin-badge" style="display:none;">ADMIN</span>
      </div>

    </div>
  </div>
</nav>

<div class="container mt-4">
  <h2>Admin Dashboard</h2>

  <!-- ADD PRODUCT CARD -->
  <div class="card p-4 mt-3 shadow-sm">
    <h4>Add Product</h4>

    <div class="row mt-3 g-3">
      
      <div class="col-md-4">
        <label class="form-label fw-bold">Product Name</label>
        <input id="p_name" class="form-control" placeholder="Name">
      </div>

      <div class="col-md-2">
        <label class="form-label fw-bold">Price</label>
        <input id="p_price" class="form-control" type="number" placeholder="₹">
      </div>

      <div class="col-md-3">
        <label class="form-label fw-bold">Category</label>
        <select id="p_category" class="form-control">
          <option value="summer">Summer</option>
          <option value="winter">Winter</option>
          <option value="dailywear">Daily Wear</option>
          <option value="casuals">Casuals</option>
          <option value="premiumwear">Premium Wear</option>
          <option value="wedding">Wedding</option>
          <option value="bestdeals">Best Deals (Auto)</option>
          <option value="sales">Sales (Admin Only)</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label fw-bold">Stock</label>
        <select id="p_stock" class="form-control">
          <option value="true">In Stock</option>
          <option value="false">Out of Stock</option>
        </select>
      </div>

      <div class="col-md-12">
        <label class="form-label fw-bold">Description</label>
        <textarea id="p_desc" class="form-control" rows="2"></textarea>
      </div>

      <!-- IMAGES -->
      <div class="col-md-12">
        <label class="form-label fw-bold">Upload Images (2–5)</label>
        <input id="p_images" class="form-control" type="file" accept="image/*" multiple>
        <div id="imagePreview" class="d-flex mt-2"></div>
      </div>

      <!-- VIDEO -->
      <div class="col-md-12">
        <label class="form-label fw-bold">Upload Video (optional)</label>
        <input id="p_video" class="form-control" type="file" accept="video/*">
      </div>

    </div>

    <button class="btn btn-success mt-3" onclick="adminAddProduct()">Add Product</button>
  </div>

  <!-- PRODUCT LIST -->
  <h4 class="mt-4">All Products</h4>
  <div id="productsAdminList"></div>

</div>

<!-- JS FILES -->
<script src="js/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>

/* LIVE IMAGE PREVIEW */
document.getElementById("p_images").addEventListener("change", function() {
  const preview = document.getElementById("imagePreview");
  preview.innerHTML = "";

  [...this.files].forEach(file => {
    const img = document.createElement("img");
    img.src = URL.createObjectURL(file);
    img.className = "thumb-preview";
    preview.appendChild(img);
  });
});


/******************************************************
 * ADMIN — ADD PRODUCT
 ******************************************************/
function adminAddProduct() {
  const name = p_name.value.trim();
  const price = Number(p_price.value.trim());
  const category = p_category.value;
  const desc = p_desc.value.trim();
  const stock = (p_stock.value === "true");
  const imgFiles = p_images.files;
  const videoFile = p_video.files[0] || null;

  if (!name || !price || imgFiles.length < 2) {
    return alert("Add name, price and minimum 2 images.");
  }

  let imagesArr = [];

  for (let file of imgFiles) {
    imagesArr.push(URL.createObjectURL(file));
  }

  const product = {
    _id: "P" + Math.random().toString(36).slice(2, 10),
    name,
    price,
    category,
    inStock: stock,
    description: desc,
    images: imagesArr,
    video: videoFile ? URL.createObjectURL(videoFile) : null,
    addedAt: Date.now(),
    orderCount: 0,
    sales: category === "sales"
  };

  const list = JSON.parse(localStorage.getItem("products") || "[]");
  list.push(product);
  localStorage.setItem("products", JSON.stringify(list));

  alert("Product added successfully!");
  renderAdminProducts();
}


/******************************************************
 * ADMIN — RENDER PRODUCTS
 ******************************************************/
function renderAdminProducts() {
  const out = document.getElementById("productsAdminList");
  const list = JSON.parse(localStorage.getItem("products") || "[]");

  if (!list.length) return out.innerHTML = "<p>No products added yet.</p>";

  out.innerHTML = list.map(p => `

    <div class="card p-3 mt-2 shadow-sm">
      <div class="d-flex align-items-center gap-3">

        <img src="${p.images[0]}" style="width:95px;height:80px;object-fit:cover;border-radius:6px;">

        <div>
          <h5 class="mb-1">${p.name}</h5>
          <p class="mb-1">₹${p.price} — ${p.category}</p>

          <span class="badge ${p.inStock ? "bg-success" : "bg-danger"}">
            ${p.inStock ? "In Stock" : "Out of Stock"}
          </span>
        </div>

      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-sm btn-info" onclick="toggleStock('${p._id}')">
          ${p.inStock ? "Mark Out of Stock" : "Mark In Stock"}
        </button>

        <button class="btn btn-sm btn-danger" onclick="deleteProduct('${p._id}')">
          Delete
        </button>
      </div>

    </div>

  `).join("");
}


/******************************************************
 * ADMIN — TOGGLE STOCK
 ******************************************************/
function toggleStock(id) {
  let list = JSON.parse(localStorage.getItem("products") || "[]");
  let p = list.find(x => x._id === id);
  if (p) p.inStock = !p.inStock;
  localStorage.setItem("products", JSON.stringify(list));
  renderAdminProducts();
}


/******************************************************
 * ADMIN — DELETE PRODUCT
 ******************************************************/
function deleteProduct(id) {
  let list = JSON.parse(localStorage.getItem("products") || "[]");
  list = list.filter(p => p._id !== id);
  localStorage.setItem("products", JSON.stringify(list));
  renderAdminProducts();
}


/******************************************************
 * ADMIN ACCESS CHECK
 ******************************************************/
document.addEventListener("DOMContentLoaded", () => {
  const user = getUser();
  if (!user || user.email !== "sohabrar10@gmail.com") {
    alert("Admin access only.");
    location.href = "index.html";
  }

  renderAdminProducts();
});

</script>

</body>
</html>
